pool:
  name: mypool
  agent: myagent

variables:
  system.debug: true

steps:
  - task: Maven@3
    inputs:
      mavenPomFile: 'pom.xml'
      goals: 'clean test'
      options: '-Dsurefire.suiteXmlFiles=src/test/resources/TestSuite.xml'

  - powershell: |
      $testResultsPath = "$(Agent.WorkFolder)\1\s\test-output\testng-results.xml"
      Write-Host "Listing contents of directory: $(Agent.WorkFolder)\1\s\test-output"
      Get-ChildItem "$(Agent.WorkFolder)\1\s\test-output"
      if (Test-Path $testResultsPath) {
        Write-Host "Test result file exists: $testResultsPath"
      } else {
        Write-Host "Test result file does not exist: $testResultsPath"
      }
    displayName: 'Verify Test Result File'
    condition: succeededOrFailed()

  - task: PublishTestResults@2
    inputs:
      testResultsFiles: '$(Build.Repository.LocalPath)\**\testng-results.xml'
      testRunTitle: 'TestNG Test Run'
      testConfiguration: 'Development'
      testPlatform: 'Java'
      publishRunAttachments: false
    displayName: 'Publish TestNG Test Results'
    condition: succeededOrFailed()

  - task: DeleteFiles@1
    inputs:
      SourceFolder: '$(Agent.WorkFolder)'
      Contents: '**'
      CleanTargetFolder: true
    displayName: 'Delete all files from _work directory'
    continueOnError: true
    condition: succeededOrFailed()