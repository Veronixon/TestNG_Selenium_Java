pool:
  name: mypool
  agent: myagent

variables:
  system.debug: true

steps:
  - task: Maven@3
    inputs:
      mavenPomFile: 'pom.xml'
      goals: 'clean test'
      options: '-Dsurefire.suiteXmlFiles=src/test/resources/TestSuite.xml'

  - task: PowerShell@2
    inputs:
      targetType: 'inline'
      script: |
        $filePath = "$(Agent.WorkFolder)\test-output\testng-results.xml"
        if (Test-Path $filePath) {
          Write-Host "File $filePath exists."
        } else {
          Write-Host "File $filePath does not exist."
        }
    displayName: 'Check if file exists'

  - task: PublishTestResults@2
    inputs:
      testResultsFiles: '**/test-output/testng-results.xml'
      testRunTitle: 'TestNG Test Run'
      testConfiguration: 'Development'
      testPlatform: 'Java'
      publishRunAttachments: false
    displayName: 'Publish TestNG Test Results'
    condition: succeededOrFailed()

  - task: DeleteFiles@1
    inputs:
      SourceFolder: '$(Agent.WorkFolder)'
      Contents: '**'
      CleanTargetFolder: true
    displayName: 'Delete all files from _work directory'
    continueOnError: true
    condition: succeededOrFailed()